# Bitmapファイル

Windowsが開発した画像フォーマットで、圧縮をせず、ピクセルと色の要素(RGB)がそのまま並んでいるため、バイナリでの分析が簡単であることが特徴です。  

## ファイル構造

Bitmapファイルはヘッダ部とボディ部に分類されます。

| 分類 | 説明 |
| ---- | ---- |
| ヘッダ部 | ファイル全体に関する設定を記載する部分。 |
| ボディ部 | 画像のピクセルと色情報を記載する部分。 |

## ヘッダ部

| データ順序 | データ量[byte] | 説明 | 補足  |
| :---- | :---- | :---- | :---- |
| 0～1 | 2 | フォーマット種類 | BMPなら0x42、0x4d |
| 2～5 | 4 | ファイルサイズ | 単位[byte] |
| 6～7 | 2 | 予約領域① | 将来の拡張用領域（常に0） |
| 8～9 | 2 | 予約領域② | 将来の拡張用領域（常に0） |
| 10～13 | 4 | ヘッダサイズ | データ部の先頭位置がわかる。 |
| 14～17 | 4 | 情報ヘッダのサイズ | 40[byte] |
| 18～21 | 4 | 画像の幅 | 単位[px] |
| 22～25 | 4 | 画像の高さ | 単位[px] |
| 26～27 | 2 | プレーン数 | 常に1 |
| 28～29 | 2 | 1画素の色数 | 単位[bit]でRGBカラーなら24, グレースケール（単色）なら8 |
| 30～33 | 4 | 圧縮形式 |  |
| 34～37 | 4 | 圧縮サイズ | 単位[byte] |
| 38～41 | 4 | 水平解像度 | 単位[ppm]=[px/m] |
| 42～45 | 4 | 垂直解像度 | 単位[ppm]=[px/m] |
| 46～49 | 4 | 色数 | 0なら全色使用。　|
| 50～53 | 4 | 重要色数 | 0なら全色使用 |

## ボディ部

ヘッダ部の「ヘッダサイズ(10～13)」に記述されているバイト数からボディ部が始まります。  
通常のフルカラー画像の場合は「BGRA」の順番でピクセルが並んでいます。  

また、左上から右下(横方向)に進んでいくのはなく、左下から右上(横方向)に進んでいきます。  

例えば、ヘッダサイズが「138」の場合のファイル構造は以下のようになります。  
プログラムで処理する場合には、配列ライクなデータ型のインデックス番号が「0」から始まることに注意してください。  
ここでも、ゼロをスタートとしています。  

| バイト | 説明 |
| ---- | ---- |
| 138 | 画像の一番左下のB(青)成分 |
| 139 | 画像の一番左下のG(青)成分 |
| 140 | 画像の一番左下のR(赤)成分 |
| 141 | 画像の一番左下のA(透過度)成分 |
| 142 | 画像の一番左下の右隣のB(青)成分 |
| 143 | 画像の一番左下の右隣のG(緑)成分 |
| 144 | 画像の一番左下の右隣のR(赤)成分 |
| 145 | 画像の一番左下の右隣のA(透過度)成分 |

## 参考文献

- [Bitmapについて](https://algorithm.joho.info/image-processing/bmp-file-data-header/)
